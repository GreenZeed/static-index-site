<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportVisual Lite</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Montserrat:wght@700;800;900&family=Bebas+Neue&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #f5f5f7;
            --bg-secondary: white;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --border-color: #e5e5ea;
            --input-bg: #f9f9f9;
            --accent-color: #007AFF;
        }
        
        [data-theme="dark"] {
            --bg-primary: #1c1c1e;
            --bg-secondary: #2c2c2e;
            --text-primary: #f5f5f7;
            --text-secondary: #98989d;
            --border-color: #38383a;
            --input-bg: #3a3a3c;
            --accent-color: #0a84ff;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg-primary); height: 100vh; overflow: hidden; transition: background 0.3s ease; }
        .app { display: flex; height: 100vh; }
        .sidebar { width: 420px; background: var(--bg-secondary); display: flex; flex-direction: column; box-shadow: 2px 0 12px rgba(0,0,0,0.08); z-index: 10; flex-shrink: 0; transition: background 0.3s ease; }
        .sidebar-header { padding: 24px; border-bottom: 1px solid var(--border-color); }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 24px; }
        .logo { font-size: 24px; font-weight: 800; color: var(--accent-color); margin-bottom: 12px; }
        .theme-switcher { display: flex; gap: 8px; margin-bottom: 12px; }
        .theme-btn { padding: 8px 12px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s; flex: 1; color: var(--text-primary); }
        .theme-btn.active { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .undo-redo-bar { display: flex; gap: 8px; margin-top: 12px; }
        .icon-btn { padding: 8px 12px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s; flex: 1; color: var(--text-primary); }
        .icon-btn:hover:not(:disabled) { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .icon-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .section { margin-bottom: 24px; }
        .section-title { font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 12px; letter-spacing: 0.5px; }
        select, input[type="text"], input[type="number"], textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: var(--input-bg); transition: all 0.2s; font-family: inherit; color: var(--text-primary); }
        textarea { min-height: 80px; resize: vertical; }
        select:focus, input:focus, textarea:focus { outline: none; border-color: var(--accent-color); background: var(--bg-secondary); }
        .format-btns, .font-selector, .pattern-grid, .effect-grid, .filter-grid, .club-grid, .season-grid { display: flex; gap: 8px; flex-wrap: wrap; }
        .format-btn, .font-option, .pattern-btn, .effect-btn, .filter-btn, .club-btn, .season-btn { padding: 12px; border: 2px solid var(--border-color); background: var(--bg-secondary); border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; flex: 1; min-width: 80px; text-align: center; color: var(--text-primary); }
        .pattern-btn, .effect-btn, .filter-btn, .club-btn, .season-btn { min-width: 45%; }
        .format-btn.active, .font-option.active, .pattern-btn.active, .effect-btn.active, .filter-btn.active, .club-btn.active, .season-btn.active { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .field { margin-bottom: 16px; }
        .field label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: var(--text-primary); }
        .color-field { display: flex; gap: 8px; align-items: center; }
        input[type="color"] { width: 50px; height: 40px; border: none; border-radius: 6px; cursor: pointer; }
        .hex-display { flex: 1; padding: 10px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 6px; font-family: monospace; font-size: 13px; text-align: center; color: var(--text-primary); }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: var(--border-color); outline: none; -webkit-appearance: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--accent-color); cursor: pointer; }
        .range-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-top: 4px; }
        .image-upload { position: relative; }
        .image-upload input[type="file"] { display: none; }
        .image-upload-btn { width: 100%; padding: 12px; border: 2px dashed var(--border-color); border-radius: 8px; background: var(--input-bg); cursor: pointer; text-align: center; transition: all 0.2s; font-size: 13px; color: var(--text-secondary); }
        .image-upload-btn:hover { border-color: var(--accent-color); background: var(--bg-secondary); color: var(--accent-color); }
        .image-upload-btn.has-image { border-style: solid; border-color: #34c759; background: rgba(52, 199, 89, 0.1); color: #34c759; }
        .btn-download, .btn-secondary, .btn-share { width: 100%; padding: 16px; background: var(--accent-color); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; margin-top: 12px; transition: all 0.2s; }
        .btn-download:hover { opacity: 0.9; }
        .btn-download:active { transform: scale(0.98); }
        .btn-secondary { background: var(--bg-secondary); color: var(--accent-color); border: 2px solid var(--accent-color); }
        .btn-secondary:hover { background: var(--input-bg); }
        .btn-share { background: #34c759; }
        .btn-share:hover { background: #2fb550; }
        .share-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .share-btn { padding: 10px; border: 2px solid var(--border-color); background: var(--bg-secondary); border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; color: var(--text-primary); }
        .share-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .share-btn.whatsapp { border-color: #25D366; color: #25D366; }
        .share-btn.whatsapp:hover { background: #25D366; color: white; }
        .share-btn.email { border-color: #007AFF; color: #007AFF; }
        .share-btn.email:hover { background: #007AFF; color: white; }
        .share-btn.twitter { border-color: #1DA1F2; color: #1DA1F2; }
        .share-btn.twitter:hover { background: #1DA1F2; color: white; }
        .share-btn.facebook { border-color: #1877F2; color: #1877F2; }
        .share-btn.facebook:hover { background: #1877F2; color: white; }
        .share-btn.copy { border-color: var(--text-secondary); color: var(--text-secondary); }
        .share-btn.copy:hover { background: var(--text-secondary); color: white; }
        .saved-templates { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 200px; overflow-y: auto; }
        .template-card { position: relative; padding: 12px; background: var(--input-bg); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .template-card:hover { border-color: var(--accent-color); background: var(--bg-secondary); }
        .template-card-name { font-size: 12px; font-weight: 600; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary); }
        .template-card-date { font-size: 10px; color: var(--text-secondary); }
        .template-card-delete { position: absolute; top: 8px; right: 8px; width: 20px; height: 20px; background: #ff3b30; color: white; border: none; border-radius: 50%; font-size: 12px; cursor: pointer; opacity: 0; transition: opacity 0.2s; }
        .template-card:hover .template-card-delete { opacity: 1; }
        .empty-state { text-align: center; padding: 24px; color: var(--text-secondary); font-size: 13px; }
        .preview { flex: 1; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; position: relative; overflow: hidden; }
        .preview.fullscreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1000; padding: 20px; }
        .preview-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; background: rgba(255,255,255,0.95); padding: 8px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        [data-theme="dark"] .preview-controls { background: rgba(44,44,46,0.95); }
        .ctrl-btn { padding: 8px 16px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; color: var(--text-primary); }
        .ctrl-btn:hover { background: var(--accent-color); color: white; border-color: var(--accent-color); }
        .preview-container { position: relative; display: flex; align-items: center; justify-content: center; max-width: 100%; max-height: 100%; transition: transform 0.3s ease; }
        .preview-wrapper { background: white; box-shadow: 0 50px 100px rgba(0,0,0,0.3); border-radius: 12px; overflow: hidden; position: relative; }
        #canvas { display: block; max-width: min(600px, calc(100vw - 420px - 120px)); max-height: calc(100vh - 120px); width: auto; height: auto; }
        .preview.fullscreen #canvas { max-width: 90vw; max-height: 90vh; }
        .format-info { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.95); padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; color: #1d1d1f; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 10; }
        [data-theme="dark"] .format-info { background: rgba(44,44,46,0.95); color: #f5f5f7; }
        .notification { position: fixed; bottom: 30px; right: 30px; background: #34c759; color: white; padding: 16px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 9999; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .collapsible { cursor: pointer; user-select: none; display: flex; justify-content: space-between; align-items: center; }
        .collapsible::after { content: '‚ñº'; font-size: 10px; transition: transform 0.2s; }
        .collapsible.collapsed::after { transform: rotate(-90deg); }
        .collapsible-content { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease; }
        .collapsible-content.collapsed { max-height: 0; }
        .match-group { background: var(--input-bg); padding: 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--border-color); }
        .match-group-title { font-size: 13px; font-weight: 600; color: var(--accent-color); margin-bottom: 12px; }
        @media (max-width: 768px) { .app { flex-direction: column; } .sidebar { width: 100%; max-height: 40vh; } #canvas { max-width: calc(100vw - 80px); max-height: calc(60vh - 80px); } }
    </style>
</head>
<body>

<div class="app">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">SportVisual Lite</div>
            <div class="theme-switcher">
                <button class="theme-btn active" data-ui-theme="light">‚òÄÔ∏è Clair</button>
                <button class="theme-btn" data-ui-theme="dark">üåô Sombre</button>
            </div>
            <div class="undo-redo-bar">
                <button class="icon-btn" id="btn-undo" title="Annuler (Ctrl+Z)">‚Ü©Ô∏è Annuler</button>
                <button class="icon-btn" id="btn-redo" title="R√©tablir (Ctrl+Y)">‚Ü™Ô∏è R√©tablir</button>
            </div>
        </div>

        <div class="sidebar-content">
            <div class="section">
                <div class="section-title">Templates sauvegard√©s</div>
                <div id="saved-templates" class="saved-templates">
                    <div class="empty-state">Aucun template sauvegard√©</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Mod√®le</div>
                <select id="template-select">
                    <option value="match">Match √† venir</option>
                    <option value="score">Score final</option>
                    <option value="player">Joueur du match</option>
                    <option value="ranking">Classement</option>
                    <option value="upnext">Calendrier - Up Next</option>
                </select>
            </div>

            <!-- THEMES CLUBS -->
            <div class="section">
                <div class="section-title collapsible" id="clubs-toggle">Th√®mes de clubs</div>
                <div class="collapsible-content" id="clubs-content">
                    <div class="club-grid">
                        <button class="club-btn" data-club="custom">‚ú® Personnalis√©</button>
                        <button class="club-btn" data-club="psg">üî¥ PSG</button>
                        <button class="club-btn" data-club="om">üîµ OM</button>
                        <button class="club-btn" data-club="ol">üî¥ OL</button>
                        <button class="club-btn" data-club="asse">üü¢ ASSE</button>
                        <button class="club-btn" data-club="losc">üî¥ LOSC</button>
                        <button class="club-btn" data-club="monaco">üî¥ Monaco</button>
                        <button class="club-btn" data-club="rennes">üî¥ Rennes</button>
                    </div>
                </div>
            </div>

            <!-- THEMES SAISONS -->
            <div class="section">
                <div class="section-title collapsible" id="seasons-toggle">Th√®mes saisonniers</div>
                <div class="collapsible-content" id="seasons-content">
                    <div class="season-grid">
                        <button class="season-btn" data-season="none">‚ùå Standard</button>
                        <button class="season-btn" data-season="christmas">üéÑ No√´l</button>
                        <button class="season-btn" data-season="summer">‚òÄÔ∏è √ât√©</button>
                        <button class="season-btn" data-season="playoffs">üèÜ Playoffs</button>
                        <button class="season-btn" data-season="halloween">üéÉ Halloween</button>
                        <button class="season-btn" data-season="valentine">‚ù§Ô∏è St-Valentin</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Format</div>
                <div class="format-btns">
                    <button class="format-btn active" data-format="square">Carr√©</button>
                    <button class="format-btn" data-format="portrait">Portrait</button>
                    <button class="format-btn" data-format="story">Story</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Police</div>
                <div class="font-selector">
                    <button class="font-option active" data-font="Inter">Inter</button>
                    <button class="font-option" data-font="Montserrat">Montserrat</button>
                    <button class="font-option" data-font="Bebas Neue">Bebas</button>
                    <button class="font-option" data-font="Oswald">Oswald</button>
                </div>
            </div>

            <div id="form-fields"></div>

            <!-- EFFECTS SECTION -->
            <div class="section">
                <div class="section-title collapsible" id="effects-toggle">Effets visuels</div>
                <div class="collapsible-content" id="effects-content">
                    <div class="effect-grid" style="margin-bottom: 12px;">
                        <button class="effect-btn" data-effect="none">‚ùå Aucun</button>
                        <button class="effect-btn" data-effect="shadow">üåí Ombre</button>
                        <button class="effect-btn" data-effect="glow">‚ú® Glow</button>
                        <button class="effect-btn" data-effect="neon">üí° Neon</button>
                    </div>
                    <div class="field" id="effect-intensity-field" style="display: none;">
                        <label>Intensit√© de l'effet</label>
                        <input type="range" id="effect-intensity" min="1" max="10" value="5">
                        <div class="range-label"><span>1</span><span id="effect-intensity-val">5</span><span>10</span></div>
                    </div>
                </div>
            </div>

            <!-- PATTERNS SECTION -->
            <div class="section">
                <div class="section-title collapsible" id="patterns-toggle">Patterns de fond</div>
                <div class="collapsible-content" id="patterns-content">
                    <div class="pattern-grid">
                        <button class="pattern-btn active" data-pattern="none">‚ùå Aucun</button>
                        <button class="pattern-btn" data-pattern="stripes">üìè Rayures</button>
                        <button class="pattern-btn" data-pattern="dots">‚¨§ Points</button>
                        <button class="pattern-btn" data-pattern="hexagons">‚¨¢ Hexagones</button>
                        <button class="pattern-btn" data-pattern="grid">‚Øê Grille</button>
                    </div>
                </div>
            </div>

            <!-- FILTERS SECTION -->
            <div class="section">
                <div class="section-title collapsible" id="filters-toggle">Filtres d'images</div>
                <div class="collapsible-content" id="filters-content">
                    <div class="filter-grid">
                        <button class="filter-btn active" data-filter="none">‚ùå Aucun</button>
                        <button class="filter-btn" data-filter="grayscale">‚ö™ N&B</button>
                        <button class="filter-btn" data-filter="sepia">üçÅ S√©pia</button>
                        <button class="filter-btn" data-filter="contrast">‚òÄÔ∏è Contraste</button>
                        <button class="filter-btn" data-filter="blur">üå´Ô∏è Flou</button>
                        <button class="filter-btn" data-filter="brightness">üí° Lumineux</button>
                    </div>
                </div>
            </div>

            <button class="btn-download" id="btn-download">üì• T√©l√©charger PNG</button>
            
            <button class="btn-share" id="btn-share">üöÄ Partager</button>
            <div class="share-buttons" id="share-buttons" style="display: none;">
                <button class="share-btn whatsapp" id="share-whatsapp"><span>üì±</span> WhatsApp</button>
                <button class="share-btn email" id="share-email"><span>‚úâÔ∏è</span> Email</button>
                <button class="share-btn twitter" id="share-twitter"><span>üê¶</span> Twitter</button>
                <button class="share-btn facebook" id="share-facebook"><span>f</span> Facebook</button>
                <button class="share-btn copy" id="share-copy"><span>üîó</span> Copier lien</button>
            </div>
            
            <button class="btn-secondary" id="btn-save-template">üíæ Sauvegarder comme template</button>
            <button class="btn-secondary" id="btn-reset">üîÑ R√©initialiser</button>
        </div>
    </aside>

    <main class="preview" id="preview">
        <div class="format-info" id="format-info">1080 x 1080</div>
        <div class="preview-controls">
            <button class="ctrl-btn" id="btn-zoom-out">‚àí Zoom</button>
            <button class="ctrl-btn" id="btn-zoom-reset">100%</button>
            <button class="ctrl-btn" id="btn-zoom-in">+ Zoom</button>
            <button class="ctrl-btn" id="btn-fullscreen">‚õ∂ Plein √©cran</button>
        </div>
        <div class="preview-container" id="preview-container">
            <div class="preview-wrapper">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </main>
</div>

<script>
class SportVisual {
    constructor() {
        this.canvas = document.getElementById('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.currentTemplate = 'match';
        this.currentFormat = 'square';
        this.currentFont = 'Inter';
        this.currentPattern = 'none';
        this.currentEffect = 'none';
        this.effectIntensity = 5;
        this.currentFilter = 'none';
        this.currentClub = 'custom';
        this.currentSeason = 'none';
        this.uiTheme = 'light';
        this.zoom = 1;
        this.history = [];
        this.historyIndex = -1;
        this.maxHistory = 20;
        
        // Club themes
        this.clubThemes = {
            psg: { color1: '#004170', color2: '#E30613', name: 'Paris Saint-Germain' },
            om: { color1: '#2FAEE0', color2: '#FFFFFF', name: 'Olympique de Marseille' },
            ol: { color1: '#DA000C', color2: '#003C7D', name: 'Olympique Lyonnais' },
            asse: { color1: '#00965E', color2: '#FFFFFF', name: 'AS Saint-√âtienne' },
            losc: { color1: '#CC0000', color2: '#000033', name: 'LOSC Lille' },
            monaco: { color1: '#CC0000', color2: '#FFFFFF', name: 'AS Monaco' },
            rennes: { color1: '#E50027', color2: '#000000', name: 'Stade Rennais' }
        };
        
        // Season themes
        this.seasonThemes = {
            christmas: { color1: '#C41E3A', color2: '#165B33', emoji: 'üéÑ', label: 'No√´l' },
            summer: { color1: '#FFD700', color2: '#FF6B35', emoji: '‚òÄÔ∏è', label: '√ât√©' },
            playoffs: { color1: '#FFD700', color2: '#000000', emoji: 'üèÜ', label: 'Playoffs' },
            halloween: { color1: '#FF6600', color2: '#1a1a1a', emoji: 'üéÉ', label: 'Halloween' },
            valentine: { color1: '#FF1493', color2: '#C71585', emoji: '‚ù§Ô∏è', label: 'St-Valentin' }
        };
        
        this.data = {
            match: { homeTeam: 'FC GEN√àVE', awayTeam: 'FC LAUSANNE', date: 'Samedi 14 D√©cembre', time: '15:00', stadium: 'Stade de Gen√®ve', color1: '#007AFF', color2: '#0051D5', bgImage: null, textSize: 80 },
            score: { homeTeam: 'FC GEN√àVE', awayTeam: 'FC LAUSANNE', homeScore: 3, awayScore: 1, competition: 'Championnat R√©gional', date: '03 D√©cembre 2025', color1: '#10B981', color2: '#059669', homeLogo: null, awayLogo: null, textSize: 48 },
            player: { playerName: 'THOMAS MULLER', number: '10', position: 'Attaquant', stats: 'Buts: 2 | Passes: 1', team: 'FC GEN√àVE', playerPhoto: null, color1: '#FF3B30', color2: '#C7221F', textSize: 70 },
            ranking: { title: 'CLASSEMENT', competition: 'Ligue 1', teams: '1. FC Gen√®ve - 45 pts\n2. FC Lausanne - 42 pts\n3. FC Sion - 38 pts\n4. Servette FC - 35 pts\n5. Young Boys - 32 pts', color1: '#5856D6', color2: '#3634A3', textSize: 32 },
            upnext: { 
                numMatches: 3,
                colorHeader: '#D32F2F', 
                colorPanel: '#FFFFFF',
                colorText: '#1f2937',
                matches: [
                    { homeTeam: 'FC GEN√àVE', awayTeam: 'FC LAUSANNE', date: 'SAM 14 OCT', time: '14H00', stadium: 'STADE DE GEN√àVE', homeLogo: null, awayLogo: null },
                    { homeTeam: 'FC SION', awayTeam: 'SERVETTE FC', date: 'DIM 15 OCT', time: '16H30', stadium: 'TOURBILLON', homeLogo: null, awayLogo: null },
                    { homeTeam: 'YOUNG BOYS', awayTeam: 'FC B√ÇLE', date: 'SAM 21 OCT', time: '18H00', stadium: 'WANKDORF', homeLogo: null, awayLogo: null }
                ]
            }
        };

        this.formats = {
            square: { width: 1080, height: 1080, label: '1080 x 1080' },
            portrait: { width: 1080, height: 1350, label: '1080 x 1350' },
            story: { width: 1080, height: 1920, label: '1080 x 1920' }
        };

        this.init();
    }

    init() {
        this.loadUITheme();
        this.loadFromStorage();
        this.loadSavedTemplates();
        this.saveToHistory();
        this.setupEventListeners();
        this.renderForm();
        this.updateFormatInfo();
        this.render();
    }

    setupEventListeners() {
        // UI Theme
        document.querySelectorAll('[data-ui-theme]').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.uiTheme = e.target.dataset.uiTheme;
            this.applyUITheme();
        }));
        
        // Club themes
        document.querySelectorAll('.club-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.club-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentClub = e.target.dataset.club;
            this.applyClubTheme();
        }));
        
        // Season themes
        document.querySelectorAll('.season-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentSeason = e.target.dataset.season;
            this.applySeasonTheme();
        }));

        // Template & Format
        document.getElementById('template-select').addEventListener('change', (e) => { this.currentTemplate = e.target.value; this.renderForm(); this.render(); });
        document.querySelectorAll('.format-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentFormat = e.target.dataset.format;
            this.updateFormatInfo();
            this.render();
        }));
        
        // Font
        document.querySelectorAll('.font-option').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.font-option').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentFont = e.target.dataset.font;
            this.render();
        }));

        // Patterns, Effects, Filters
        document.querySelectorAll('.pattern-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentPattern = e.target.dataset.pattern;
            this.saveToHistory();
            this.render();
        }));
        document.querySelectorAll('.effect-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.effect-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentEffect = e.target.dataset.effect;
            document.getElementById('effect-intensity-field').style.display = this.currentEffect !== 'none' ? 'block' : 'none';
            this.saveToHistory();
            this.render();
        }));
        document.getElementById('effect-intensity').addEventListener('input', (e) => {
            this.effectIntensity = parseInt(e.target.value);
            document.getElementById('effect-intensity-val').textContent = e.target.value;
            this.render();
        });
        document.querySelectorAll('.filter-btn').forEach(btn => btn.addEventListener('click', (e) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentFilter = e.target.dataset.filter;
            this.saveToHistory();
            this.render();
        }));

        // Collapsibles
        ['effects', 'patterns', 'filters', 'clubs', 'seasons'].forEach(section => {
            const toggle = document.getElementById(`${section}-toggle`);
            if (toggle) {
                toggle.addEventListener('click', () => {
                    const content = document.getElementById(`${section}-content`);
                    content.classList.toggle('collapsed');
                    toggle.classList.toggle('collapsed');
                });
            }
        });

        // Buttons
        document.getElementById('btn-download').addEventListener('click', () => this.download());
        document.getElementById('btn-share').addEventListener('click', () => this.toggleShareButtons());
        document.getElementById('share-whatsapp').addEventListener('click', () => this.shareWhatsApp());
        document.getElementById('share-email').addEventListener('click', () => this.shareEmail());
        document.getElementById('share-twitter').addEventListener('click', () => this.shareTwitter());
        document.getElementById('share-facebook').addEventListener('click', () => this.shareFacebook());
        document.getElementById('share-copy').addEventListener('click', () => this.copyImageLink());
        document.getElementById('btn-save-template').addEventListener('click', () => this.saveAsTemplate());
        document.getElementById('btn-reset').addEventListener('click', () => this.reset());
        document.getElementById('btn-undo').addEventListener('click', () => this.undo());
        document.getElementById('btn-redo').addEventListener('click', () => this.redo());
        document.getElementById('btn-zoom-in').addEventListener('click', () => this.adjustZoom(0.1));
        document.getElementById('btn-zoom-out').addEventListener('click', () => this.adjustZoom(-0.1));
        document.getElementById('btn-zoom-reset').addEventListener('click', () => this.resetZoom());
        document.getElementById('btn-fullscreen').addEventListener('click', () => this.toggleFullscreen());

        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z') { e.preventDefault(); this.undo(); }
                else if (e.key === 'y' || (e.shiftKey && e.key === 'z')) { e.preventDefault(); this.redo(); }
            }
        });
    }

    // UI THEME
    loadUITheme() {
        const saved = localStorage.getItem('sportvisual_ui_theme');
        if (saved) this.uiTheme = saved;
        this.applyUITheme();
    }
    
    applyUITheme() {
        document.documentElement.setAttribute('data-theme', this.uiTheme);
        localStorage.setItem('sportvisual_ui_theme', this.uiTheme);
    }

    // CLUB THEMES
    applyClubTheme() {
        if (this.currentClub === 'custom') return;
        const theme = this.clubThemes[this.currentClub];
        if (theme && this.currentTemplate !== 'upnext') {
            this.data[this.currentTemplate].color1 = theme.color1;
            this.data[this.currentTemplate].color2 = theme.color2;
            this.renderForm();
            this.saveToHistory();
            this.render();
            this.showNotification(`üèÜ Th√®me ${theme.name} appliqu√© !`);
        } else if (theme && this.currentTemplate === 'upnext') {
            this.data.upnext.colorHeader = theme.color1;
            this.renderForm();
            this.saveToHistory();
            this.render();
            this.showNotification(`üèÜ Th√®me ${theme.name} appliqu√© !`);
        }
    }

    // SEASON THEMES
    applySeasonTheme() {
        if (this.currentSeason === 'none') {
            this.saveToHistory();
            this.render();
            return;
        }
        const theme = this.seasonThemes[this.currentSeason];
        if (theme && this.currentTemplate !== 'upnext') {
            this.data[this.currentTemplate].color1 = theme.color1;
            this.data[this.currentTemplate].color2 = theme.color2;
            this.renderForm();
            this.saveToHistory();
            this.render();
            this.showNotification(`${theme.emoji} Th√®me ${theme.label} appliqu√© !`);
        } else if (theme && this.currentTemplate === 'upnext') {
            this.data.upnext.colorHeader = theme.color1;
            this.renderForm();
            this.saveToHistory();
            this.render();
            this.showNotification(`${theme.emoji} Th√®me ${theme.label} appliqu√© !`);
        }
    }

    // Add seasonal decorations
    drawSeasonalDecorations() {
        if (this.currentSeason === 'none') return;
        const w = this.canvas.width, h = this.canvas.height;
        this.ctx.save();
        this.ctx.font = '60px Arial';
        
        if (this.currentSeason === 'christmas') {
            ['üéÑ', '‚ùÑÔ∏è', 'üéÅ'].forEach((emoji, i) => {
                this.ctx.globalAlpha = 0.3;
                this.ctx.fillText(emoji, 50 + i * 150, 80);
                this.ctx.fillText(emoji, w - 200 + i * 60, h - 50);
            });
        } else if (this.currentSeason === 'summer') {
            ['‚òÄÔ∏è', 'üå¥', 'üåä'].forEach((emoji, i) => {
                this.ctx.globalAlpha = 0.25;
                this.ctx.fillText(emoji, 60 + i * 140, 70);
            });
        } else if (this.currentSeason === 'playoffs') {
            ['üèÜ', '‚≠ê', 'ü•á'].forEach((emoji, i) => {
                this.ctx.globalAlpha = 0.3;
                this.ctx.fillText(emoji, w/2 - 90 + i * 90, 50);
            });
        } else if (this.currentSeason === 'halloween') {
            ['üéÉ', 'üëª', 'ü¶á'].forEach((emoji, i) => {
                this.ctx.globalAlpha = 0.25;
                this.ctx.fillText(emoji, 50 + i * 130, 80);
            });
        } else if (this.currentSeason === 'valentine') {
            ['‚ù§Ô∏è', 'üíñ', 'üíò'].forEach((emoji, i) => {
                this.ctx.globalAlpha = 0.3;
                this.ctx.fillText(emoji, w - 200, 100 + i * 100);
            });
        }
        
        this.ctx.restore();
    }

    // PATTERNS
    drawPattern(w, h) {
        if (this.currentPattern === 'none') return;
        this.ctx.save();
        this.ctx.globalAlpha = 0.1;
        this.ctx.strokeStyle = 'white';
        this.ctx.lineWidth = 2;
        if (this.currentPattern === 'stripes') {
            for (let i = 0; i < w + h; i += 40) { this.ctx.beginPath(); this.ctx.moveTo(i, 0); this.ctx.lineTo(i - h, h); this.ctx.stroke(); }
        } else if (this.currentPattern === 'dots') {
            for (let x = 0; x < w; x += 50) { for (let y = 0; y < h; y += 50) { this.ctx.beginPath(); this.ctx.arc(x, y, 4, 0, Math.PI * 2); this.ctx.fill(); } }
        } else if (this.currentPattern === 'hexagons') {
            const size = 30;
            for (let y = 0; y < h; y += size * 1.5) {
                for (let x = 0; x < w; x += size * Math.sqrt(3)) {
                    const offsetX = (y / (size * 1.5)) % 2 === 0 ? 0 : size * Math.sqrt(3) / 2;
                    this.drawHexagon(x + offsetX, y, size);
                }
            }
        } else if (this.currentPattern === 'grid') {
            for (let i = 0; i < w; i += 50) { this.ctx.beginPath(); this.ctx.moveTo(i, 0); this.ctx.lineTo(i, h); this.ctx.stroke(); }
            for (let i = 0; i < h; i += 50) { this.ctx.beginPath(); this.ctx.moveTo(0, i); this.ctx.lineTo(w, i); this.ctx.stroke(); }
        }
        this.ctx.restore();
    }

    drawHexagon(x, y, size) {
        this.ctx.beginPath();
        for (let i = 0; i < 6; i++) {
            const angle = (Math.PI / 3) * i;
            const hx = x + size * Math.cos(angle);
            const hy = y + size * Math.sin(angle);
            if (i === 0) this.ctx.moveTo(hx, hy);
            else this.ctx.lineTo(hx, hy);
        }
        this.ctx.closePath();
        this.ctx.stroke();
    }

    // EFFECTS
    applyTextEffect(text, x, y, fontSize, font) {
        const intensity = this.effectIntensity;
        if (this.currentEffect === 'shadow') {
            this.ctx.shadowColor = 'rgba(0,0,0,0.5)';
            this.ctx.shadowBlur = intensity * 3;
            this.ctx.shadowOffsetX = intensity;
            this.ctx.shadowOffsetY = intensity;
        } else if (this.currentEffect === 'glow') {
            this.ctx.shadowColor = this.ctx.fillStyle;
            this.ctx.shadowBlur = intensity * 5;
        } else if (this.currentEffect === 'neon') {
            for (let i = 0; i < 3; i++) {
                this.ctx.shadowColor = this.ctx.fillStyle;
                this.ctx.shadowBlur = intensity * 8;
                this.ctx.fillText(text, x, y);
            }
        }
        this.ctx.fillText(text, x, y);
        this.ctx.shadowColor = 'transparent';
        this.ctx.shadowBlur = 0;
        this.ctx.shadowOffsetX = 0;
        this.ctx.shadowOffsetY = 0;
    }

    // FILTERS
    applyImageFilter() {
        if (this.currentFilter === 'none') return;
        const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
        const data = imageData.data;
        for (let i = 0; i < data.length; i += 4) {
            if (this.currentFilter === 'grayscale') {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            } else if (this.currentFilter === 'sepia') {
                const r = data[i], g = data[i + 1], b = data[i + 2];
                data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
            } else if (this.currentFilter === 'contrast') {
                const factor = 2;
                data[i] = Math.min(255, ((data[i] - 128) * factor) + 128);
                data[i + 1] = Math.min(255, ((data[i + 1] - 128) * factor) + 128);
                data[i + 2] = Math.min(255, ((data[i + 2] - 128) * factor) + 128);
            } else if (this.currentFilter === 'brightness') {
                const brightness = 50;
                data[i] = Math.min(255, data[i] + brightness);
                data[i + 1] = Math.min(255, data[i + 1] + brightness);
                data[i + 2] = Math.min(255, data[i + 2] + brightness);
            }
        }
        this.ctx.putImageData(imageData, 0, 0);
    }

    // SHARE FUNCTIONS
    toggleShareButtons() { const shareButtons = document.getElementById('share-buttons'); shareButtons.style.display = shareButtons.style.display === 'none' ? 'grid' : 'none'; }
    getImageDataURL() { return this.canvas.toDataURL('image/png'); }
    shareWhatsApp() { this.download(); this.showNotification('üì± Image t√©l√©charg√©e ! Partagez-la sur WhatsApp'); setTimeout(() => window.open(`https://wa.me/?text=${encodeURIComponent('D√©couvrez mon visuel cr√©√© avec SportVisual Lite !')}`, '_blank'), 500); }
    shareEmail() {
        const d = this.data[this.currentTemplate];
        let subject = `Mon visuel SportVisual - ${this.currentTemplate}`, body = `Bonjour,\n\nJe partage avec vous mon visuel cr√©√© avec SportVisual Lite.\n\n`;
        if (this.currentTemplate === 'match') body += `Match: ${d.homeTeam} vs ${d.awayTeam}\nDate: ${d.date} √† ${d.time}\nLieu: ${d.stadium}\n`;
        else if (this.currentTemplate === 'score') body += `Score: ${d.homeTeam} ${d.homeScore} - ${d.awayScore} ${d.awayTeam}\nComp√©tition: ${d.competition}\n`;
        body += `\nL'image est en pi√®ce jointe.\n\nCr√©√© avec SportVisual Lite`;
        this.download(); this.showNotification('‚úâÔ∏è Image t√©l√©charg√©e ! Ajoutez-la √† votre email');
        window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
    shareTwitter() {
        const d = this.data[this.currentTemplate];
        let text = '';
        if (this.currentTemplate === 'match') text = `üî• ${d.homeTeam} vs ${d.awayTeam}\nüìÖ ${d.date} √† ${d.time}\nüèüÔ∏è ${d.stadium}`;
        else if (this.currentTemplate === 'score') text = `‚öΩ Score final: ${d.homeTeam} ${d.homeScore} - ${d.awayScore} ${d.awayTeam}\nüèÜ ${d.competition}`;
        else if (this.currentTemplate === 'player') text = `‚≠ê Joueur du match: ${d.playerName} (#${d.number})\n${d.stats}`;
        text += '\n\nCr√©√© avec SportVisual Lite';
        this.download(); this.showNotification('üê¶ Image t√©l√©charg√©e ! Uploadez-la sur Twitter');
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
    }
    shareFacebook() { this.download(); this.showNotification('f Image t√©l√©charg√©e ! Partagez-la sur Facebook'); window.open('https://www.facebook.com/', '_blank'); }
    async copyImageLink() {
        try {
            const blob = await new Promise(resolve => this.canvas.toBlob(resolve, 'image/png'));
            if (navigator.clipboard && navigator.clipboard.write) {
                const item = new ClipboardItem({ 'image/png': blob });
                await navigator.clipboard.write([item]);
                this.showNotification('‚úÖ Image copi√©e dans le presse-papiers !');
            } else { this.download(); this.showNotification('üîó Image t√©l√©charg√©e !'); }
        } catch (err) { this.download(); this.showNotification('üîó Image t√©l√©charg√©e !'); }
    }
    showNotification(message) {
        const existing = document.querySelector('.notification');
        if (existing) existing.remove();
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    // HISTORY
    saveToHistory() {
        const state = JSON.stringify({ data: this.data, template: this.currentTemplate, format: this.currentFormat, font: this.currentFont, pattern: this.currentPattern, effect: this.currentEffect, effectIntensity: this.effectIntensity, filter: this.currentFilter, club: this.currentClub, season: this.currentSeason });
        if (this.historyIndex < this.history.length - 1) this.history = this.history.slice(0, this.historyIndex + 1);
        this.history.push(state);
        if (this.history.length > this.maxHistory) this.history.shift(); else this.historyIndex++;
        this.updateUndoRedoButtons();
    }
    undo() { if (this.historyIndex > 0) { this.historyIndex--; this.restoreFromHistory(); } }
    redo() { if (this.historyIndex < this.history.length - 1) { this.historyIndex++; this.restoreFromHistory(); } }
    restoreFromHistory() {
        const state = JSON.parse(this.history[this.historyIndex]);
        this.data = state.data; this.currentTemplate = state.template; this.currentFormat = state.format; this.currentFont = state.font;
        this.currentPattern = state.pattern || 'none'; this.currentEffect = state.effect || 'none'; 
        this.effectIntensity = state.effectIntensity || 5; this.currentFilter = state.filter || 'none';
        this.currentClub = state.club || 'custom'; this.currentSeason = state.season || 'none';
        document.getElementById('template-select').value = this.currentTemplate;
        document.querySelectorAll('.format-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.format === this.currentFormat));
        document.querySelectorAll('.font-option').forEach(btn => btn.classList.toggle('active', btn.dataset.font === this.currentFont));
        document.querySelectorAll('.pattern-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.pattern === this.currentPattern));
        document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.effect === this.currentEffect));
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.filter === this.currentFilter));
        document.querySelectorAll('.club-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.club === this.currentClub));
        document.querySelectorAll('.season-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.season === this.currentSeason));
        document.getElementById('effect-intensity').value = this.effectIntensity;
        document.getElementById('effect-intensity-val').textContent = this.effectIntensity;
        document.getElementById('effect-intensity-field').style.display = this.currentEffect !== 'none' ? 'block' : 'none';
        this.renderForm(); this.updateFormatInfo(); this.render(); this.updateUndoRedoButtons();
    }
    updateUndoRedoButtons() {
        document.getElementById('btn-undo').disabled = this.historyIndex <= 0;
        document.getElementById('btn-redo').disabled = this.historyIndex >= this.history.length - 1;
    }

    adjustZoom(delta) { this.zoom = Math.max(0.5, Math.min(2, this.zoom + delta)); this.applyZoom(); }
    resetZoom() { this.zoom = 1; this.applyZoom(); }
    applyZoom() { document.getElementById('preview-container').style.transform = `scale(${this.zoom})`; document.getElementById('btn-zoom-reset').textContent = `${Math.round(this.zoom * 100)}%`; }
    toggleFullscreen() { const preview = document.getElementById('preview'); preview.classList.toggle('fullscreen'); document.getElementById('btn-fullscreen').textContent = preview.classList.contains('fullscreen') ? '‚ùå Quitter' : '‚õ∂ Plein √©cran'; }

    saveAsTemplate() {
        const name = prompt('Nom du template :', `${this.currentTemplate}-${Date.now()}`);
        if (!name) return;
        const templates = JSON.parse(localStorage.getItem('sportvisual_templates') || '[]');
        templates.unshift({ name, date: new Date().toLocaleString('fr-FR'), data: this.data, template: this.currentTemplate, format: this.currentFormat, font: this.currentFont, pattern: this.currentPattern, effect: this.currentEffect, effectIntensity: this.effectIntensity, filter: this.currentFilter, club: this.currentClub, season: this.currentSeason });
        if (templates.length > 10) templates.pop();
        localStorage.setItem('sportvisual_templates', JSON.stringify(templates));
        this.loadSavedTemplates();
        this.showNotification('‚úÖ Template sauvegard√© !');
    }

    loadSavedTemplates() {
        const templates = JSON.parse(localStorage.getItem('sportvisual_templates') || '[]');
        const container = document.getElementById('saved-templates');
        if (templates.length === 0) { container.innerHTML = '<div class="empty-state">Aucun template sauvegard√©</div>'; return; }
        container.innerHTML = templates.map((t, i) => `<div class="template-card" data-index="${i}"><div class="template-card-name">${t.name}</div><div class="template-card-date">${t.date}</div><button class="template-card-delete" data-index="${i}">√ó</button></div>`).join('');
        container.querySelectorAll('.template-card').forEach(card => card.addEventListener('click', (e) => { if (e.target.classList.contains('template-card-delete')) return; this.loadTemplate(templates[parseInt(card.dataset.index)]); }));
        container.querySelectorAll('.template-card-delete').forEach(btn => btn.addEventListener('click', (e) => { e.stopPropagation(); this.deleteTemplate(parseInt(btn.dataset.index)); }));
    }

    loadTemplate(template) {
        this.data = template.data; this.currentTemplate = template.template; this.currentFormat = template.format; this.currentFont = template.font;
        this.currentPattern = template.pattern || 'none'; this.currentEffect = template.effect || 'none';
        this.effectIntensity = template.effectIntensity || 5; this.currentFilter = template.filter || 'none';
        this.currentClub = template.club || 'custom'; this.currentSeason = template.season || 'none';
        document.getElementById('template-select').value = this.currentTemplate;
        document.querySelectorAll('.format-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.format === this.currentFormat));
        document.querySelectorAll('.font-option').forEach(btn => btn.classList.toggle('active', btn.dataset.font === this.currentFont));
        document.querySelectorAll('.pattern-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.pattern === this.currentPattern));
        document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.effect === this.currentEffect));
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.filter === this.currentFilter));
        document.querySelectorAll('.club-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.club === this.currentClub));
        document.querySelectorAll('.season-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.season === this.currentSeason));
        document.getElementById('effect-intensity').value = this.effectIntensity;
        document.getElementById('effect-intensity-val').textContent = this.effectIntensity;
        this.renderForm(); this.updateFormatInfo(); this.render(); this.saveToHistory();
    }

    deleteTemplate(index) { if (!confirm('Supprimer ce template ?')) return; const templates = JSON.parse(localStorage.getItem('sportvisual_templates') || '[]'); templates.splice(index, 1); localStorage.setItem('sportvisual_templates', JSON.stringify(templates)); this.loadSavedTemplates(); }
    loadFromStorage() { const saved = localStorage.getItem('sportvisual_data'); if (saved) { try { this.data = { ...this.data, ...JSON.parse(saved) }; } catch (e) {} } }
    saveToStorage() { localStorage.setItem('sportvisual_data', JSON.stringify(this.data)); this.saveToHistory(); }
    reset() { if (confirm('R√©initialiser toutes les donn√©es ?')) { localStorage.removeItem('sportvisual_data'); location.reload(); } }
    updateFormatInfo() { document.getElementById('format-info').textContent = this.formats[this.currentFormat].label; }
    handleImageUpload(key, file, matchIndex = null) { 
        const reader = new FileReader(); 
        reader.onload = (e) => { 
            if (matchIndex !== null) {
                this.data.upnext.matches[matchIndex][key] = e.target.result;
            } else {
                this.data[this.currentTemplate][key] = e.target.result;
            }
            this.saveToStorage(); 
            this.render(); 
        }; 
        reader.readAsDataURL(file); 
    }

    renderForm() {
        const container = document.getElementById('form-fields');
        container.innerHTML = '';
        
        if (this.currentTemplate === 'upnext') {
            this.renderUpNextForm(container);
            return;
        }
        
        const fieldSets = {
            match: [{ key: 'homeTeam', label: '√âquipe Domicile', type: 'text' }, { key: 'awayTeam', label: '√âquipe Ext√©rieur', type: 'text' }, { key: 'date', label: 'Date', type: 'text' }, { key: 'time', label: 'Heure', type: 'text' }, { key: 'stadium', label: 'Stade', type: 'text' }, { key: 'textSize', label: 'Taille texte', type: 'range', min: 40, max: 120 }, { key: 'bgImage', label: 'Image de fond (optionnel)', type: 'image' }, { key: 'color1', label: 'Couleur 1', type: 'color' }, { key: 'color2', label: 'Couleur 2 (gradient)', type: 'color' }],
            score: [{ key: 'homeTeam', label: '√âquipe Domicile', type: 'text' }, { key: 'awayTeam', label: '√âquipe Ext√©rieur', type: 'text' }, { key: 'homeScore', label: 'Score Domicile', type: 'number' }, { key: 'awayScore', label: 'Score Ext√©rieur', type: 'number' }, { key: 'competition', label: 'Comp√©tition', type: 'text' }, { key: 'date', label: 'Date', type: 'text' }, { key: 'textSize', label: 'Taille texte', type: 'range', min: 24, max: 72 }, { key: 'homeLogo', label: 'Logo Domicile', type: 'image' }, { key: 'awayLogo', label: 'Logo Ext√©rieur', type: 'image' }, { key: 'color1', label: 'Couleur 1', type: 'color' }, { key: 'color2', label: 'Couleur 2', type: 'color' }],
            player: [{ key: 'playerName', label: 'Nom du joueur', type: 'text' }, { key: 'number', label: 'Num√©ro', type: 'text' }, { key: 'position', label: 'Position', type: 'text' }, { key: 'stats', label: 'Statistiques', type: 'text' }, { key: 'team', label: '√âquipe', type: 'text' }, { key: 'textSize', label: 'Taille texte', type: 'range', min: 40, max: 100 }, { key: 'playerPhoto', label: 'Photo du joueur', type: 'image' }, { key: 'color1', label: 'Couleur 1', type: 'color' }, { key: 'color2', label: 'Couleur 2', type: 'color' }],
            ranking: [{ key: 'title', label: 'Titre', type: 'text' }, { key: 'competition', label: 'Comp√©tition', type: 'text' }, { key: 'teams', label: 'Classement (une ligne par √©quipe)', type: 'textarea' }, { key: 'textSize', label: 'Taille texte', type: 'range', min: 20, max: 48 }, { key: 'color1', label: 'Couleur 1', type: 'color' }, { key: 'color2', label: 'Couleur 2', type: 'color' }]
        };
        const fields = fieldSets[this.currentTemplate];
        fields.forEach(field => {
            const div = document.createElement('div'); div.className = 'field';
            const label = document.createElement('label'); label.textContent = field.label; div.appendChild(label);
            if (field.type === 'color') {
                const colorDiv = document.createElement('div'); colorDiv.className = 'color-field';
                const input = document.createElement('input'); input.type = 'color'; input.value = this.data[this.currentTemplate][field.key];
                const hex = document.createElement('div'); hex.className = 'hex-display'; hex.textContent = input.value;
                input.addEventListener('input', (e) => { this.data[this.currentTemplate][field.key] = e.target.value; hex.textContent = e.target.value; this.saveToStorage(); this.render(); });
                colorDiv.appendChild(input); colorDiv.appendChild(hex); div.appendChild(colorDiv);
            } else if (field.type === 'range') {
                const input = document.createElement('input'); input.type = 'range'; input.min = field.min; input.max = field.max; input.value = this.data[this.currentTemplate][field.key];
                const rangeLabel = document.createElement('div'); rangeLabel.className = 'range-label'; rangeLabel.innerHTML = `<span>${field.min}</span><span>${input.value}</span><span>${field.max}</span>`;
                input.addEventListener('input', (e) => { this.data[this.currentTemplate][field.key] = parseInt(e.target.value); rangeLabel.querySelector('span:nth-child(2)').textContent = e.target.value; this.saveToStorage(); this.render(); });
                div.appendChild(input); div.appendChild(rangeLabel);
            } else if (field.type === 'image') {
                const uploadDiv = document.createElement('div'); uploadDiv.className = 'image-upload';
                const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*'; input.id = `upload-${field.key}`;
                const btn = document.createElement('label'); btn.className = 'image-upload-btn'; btn.htmlFor = `upload-${field.key}`;
                btn.textContent = this.data[this.currentTemplate][field.key] ? '‚úì Image charg√©e' : 'üìé Choisir une image';
                if (this.data[this.currentTemplate][field.key]) btn.classList.add('has-image');
                input.addEventListener('change', (e) => { if (e.target.files[0]) { this.handleImageUpload(field.key, e.target.files[0]); btn.textContent = '‚úì Image charg√©e'; btn.classList.add('has-image'); } });
                uploadDiv.appendChild(input); uploadDiv.appendChild(btn); div.appendChild(uploadDiv);
            } else if (field.type === 'textarea') {
                const input = document.createElement('textarea'); input.value = this.data[this.currentTemplate][field.key];
                input.addEventListener('input', (e) => { this.data[this.currentTemplate][field.key] = e.target.value; this.saveToStorage(); this.render(); });
                div.appendChild(input);
            } else {
                const input = document.createElement('input'); input.type = field.type; input.value = this.data[this.currentTemplate][field.key];
                input.addEventListener('input', (e) => { this.data[this.currentTemplate][field.key] = field.type === 'number' ? parseInt(e.target.value) : e.target.value; this.saveToStorage(); this.render(); });
                div.appendChild(input);
            }
            container.appendChild(div);
        });
    }

    renderUpNextForm(container) {
        const d = this.data.upnext;
        
        // Nombre de matchs
        const numField = document.createElement('div'); numField.className = 'field';
        const numLabel = document.createElement('label'); numLabel.textContent = 'Nombre de matchs';
        const numInput = document.createElement('input'); numInput.type = 'range'; numInput.min = 2; numInput.max = 5; numInput.value = d.numMatches;
        const numRangeLabel = document.createElement('div'); numRangeLabel.className = 'range-label';
        numRangeLabel.innerHTML = `<span>2</span><span>${d.numMatches}</span><span>5</span>`;
        numInput.addEventListener('input', (e) => {
            const newNum = parseInt(e.target.value);
            const oldNum = d.numMatches;
            d.numMatches = newNum;
            numRangeLabel.querySelector('span:nth-child(2)').textContent = newNum;
            
            // Ajouter ou supprimer des matchs
            if (newNum > oldNum) {
                for (let i = oldNum; i < newNum; i++) {
                    d.matches.push({ homeTeam: '√âQUIPE A', awayTeam: '√âQUIPE B', date: 'SAM 14 OCT', time: '14H00', stadium: 'STADE', homeLogo: null, awayLogo: null });
                }
            } else {
                d.matches = d.matches.slice(0, newNum);
            }
            this.saveToStorage();
            this.renderForm();
            this.render();
        });
        numField.appendChild(numLabel); numField.appendChild(numInput); numField.appendChild(numRangeLabel);
        container.appendChild(numField);
        
        // Couleurs
        ['colorHeader', 'colorPanel', 'colorText'].forEach(colorKey => {
            const div = document.createElement('div'); div.className = 'field';
            const label = document.createElement('label'); 
            label.textContent = colorKey === 'colorHeader' ? 'Couleur en-t√™te' : colorKey === 'colorPanel' ? 'Couleur panneau' : 'Couleur texte';
            div.appendChild(label);
            const colorDiv = document.createElement('div'); colorDiv.className = 'color-field';
            const input = document.createElement('input'); input.type = 'color'; input.value = d[colorKey];
            const hex = document.createElement('div'); hex.className = 'hex-display'; hex.textContent = input.value;
            input.addEventListener('input', (e) => { d[colorKey] = e.target.value; hex.textContent = e.target.value; this.saveToStorage(); this.render(); });
            colorDiv.appendChild(input); colorDiv.appendChild(hex); div.appendChild(colorDiv);
            container.appendChild(div);
        });
        
        // Matchs
        for (let i = 0; i < d.numMatches; i++) {
            const matchGroup = document.createElement('div'); matchGroup.className = 'match-group';
            const groupTitle = document.createElement('div'); groupTitle.className = 'match-group-title';
            groupTitle.textContent = `Match ${i + 1}`;
            matchGroup.appendChild(groupTitle);
            
            ['homeTeam', 'awayTeam', 'date', 'time', 'stadium'].forEach(key => {
                const div = document.createElement('div'); div.className = 'field';
                const label = document.createElement('label');
                const labels = { homeTeam: '√âquipe Domicile', awayTeam: '√âquipe Ext√©rieure', date: 'Date', time: 'Heure', stadium: 'Stade' };
                label.textContent = labels[key];
                const input = document.createElement('input'); input.type = 'text'; input.value = d.matches[i][key];
                input.addEventListener('input', (e) => { d.matches[i][key] = e.target.value; this.saveToStorage(); this.render(); });
                div.appendChild(label); div.appendChild(input); matchGroup.appendChild(div);
            });
            
            // Logos
            ['homeLogo', 'awayLogo'].forEach(logoKey => {
                const div = document.createElement('div'); div.className = 'field';
                const label = document.createElement('label'); 
                label.textContent = logoKey === 'homeLogo' ? 'Logo Domicile' : 'Logo Ext√©rieur';
                const uploadDiv = document.createElement('div'); uploadDiv.className = 'image-upload';
                const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*'; 
                input.id = `upload-${logoKey}-${i}`;
                const btn = document.createElement('label'); btn.className = 'image-upload-btn'; btn.htmlFor = `upload-${logoKey}-${i}`;
                btn.textContent = d.matches[i][logoKey] ? '‚úì Logo charg√©' : 'üìé Choisir logo';
                if (d.matches[i][logoKey]) btn.classList.add('has-image');
                input.addEventListener('change', (e) => { 
                    if (e.target.files[0]) { 
                        this.handleImageUpload(logoKey, e.target.files[0], i); 
                        btn.textContent = '‚úì Logo charg√©'; 
                        btn.classList.add('has-image'); 
                    } 
                });
                uploadDiv.appendChild(input); uploadDiv.appendChild(btn); 
                div.appendChild(label); div.appendChild(uploadDiv); 
                matchGroup.appendChild(div);
            });
            
            container.appendChild(matchGroup);
        }
    }

    render() {
        const format = this.formats[this.currentFormat];
        this.canvas.width = format.width; this.canvas.height = format.height;
        const renderers = { 
            match: () => this.renderMatchTemplate(), 
            score: () => this.renderScoreTemplate(), 
            player: () => this.renderPlayerTemplate(), 
            ranking: () => this.renderRankingTemplate(),
            upnext: () => this.renderUpNextTemplate()
        };
        renderers[this.currentTemplate]();
        if (this.currentTemplate !== 'upnext') this.drawSeasonalDecorations();
        this.applyImageFilter();
    }

    renderUpNextTemplate() {
        const d = this.data.upnext, w = this.canvas.width, h = this.canvas.height, font = this.currentFont;
        
        // Fond rouge
        this.ctx.fillStyle = d.colorHeader;
        this.ctx.fillRect(0, 0, w, h);
        
        // Bandeau r√©p√©titif en haut
        this.ctx.fillStyle = 'rgba(0,0,0,0.2)';
        this.ctx.fillRect(0, 0, w, 50);
        this.ctx.fillStyle = 'rgba(255,255,255,0.3)';
        this.ctx.font = `bold 16px ${font}, sans-serif`;
        this.ctx.textAlign = 'left';
        const bannerText = 'NEXT FIXTURE '.repeat(20);
        this.ctx.fillText(bannerText, 0, 32);
        
        // Logo UP NEXT
        this.ctx.fillStyle = '#000000';
        this.ctx.font = `900 120px ${font}, sans-serif`;
        this.ctx.textAlign = 'left';
        this.ctx.fillText('UP', 80, 200);
        this.ctx.fillText('NEXT', 80, 310);
        
        // Fl√®ches blanches
        this.ctx.fillStyle = '#FFFFFF';
        this.ctx.font = `900 100px ${font}, sans-serif`;
        this.ctx.fillText('¬ª', 400, 265);
        
        // Panneau blanc pour les matchs
        const panelY = 380;
        const panelHeight = Math.min(h - panelY - 80, d.numMatches * 150 + 40);
        this.ctx.fillStyle = d.colorPanel;
        this.roundRect(60, panelY, w - 120, panelHeight, 20);
        this.ctx.fill();
        
        // Dessiner les matchs
        const matchHeight = 120;
        const matchSpacing = 20;
        const startY = panelY + 40;
        
        for (let i = 0; i < d.numMatches; i++) {
            const match = d.matches[i];
            const y = startY + i * (matchHeight + matchSpacing);
            
            // Logos
            if (match.homeLogo) {
                const img = new Image();
                img.src = match.homeLogo;
                img.onload = () => this.ctx.drawImage(img, 120, y, 80, 80);
            } else {
                // Shield placeholder
                this.ctx.fillStyle = d.colorHeader;
                this.ctx.beginPath();
                this.ctx.moveTo(160, y);
                this.ctx.lineTo(200, y);
                this.ctx.lineTo(200, y + 60);
                this.ctx.lineTo(180, y + 80);
                this.ctx.lineTo(160, y + 60);
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            if (match.awayLogo) {
                const img = new Image();
                img.src = match.awayLogo;
                img.onload = () => this.ctx.drawImage(img, w - 200, y, 80, 80);
            } else {
                // Shield placeholder
                this.ctx.fillStyle = '#000000';
                this.ctx.beginPath();
                this.ctx.moveTo(w - 200, y);
                this.ctx.lineTo(w - 160, y);
                this.ctx.lineTo(w - 160, y + 60);
                this.ctx.lineTo(w - 180, y + 80);
                this.ctx.lineTo(w - 200, y + 60);
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            // Textes centraux
            this.ctx.fillStyle = d.colorText;
            this.ctx.textAlign = 'center';
            this.ctx.font = `bold 32px ${font}, sans-serif`;
            this.ctx.fillText(match.date, w/2, y + 25);
            this.ctx.font = `bold 36px ${font}, sans-serif`;
            this.ctx.fillText(match.time, w/2, y + 60);
            this.ctx.font = `600 20px ${font}, sans-serif`;
            this.ctx.fillStyle = 'rgba(31, 41, 55, 0.6)';
            this.ctx.fillText(match.stadium, w/2, y + 85);
            
            // Ligne de s√©paration (sauf pour le dernier match)
            if (i < d.numMatches - 1) {
                this.ctx.strokeStyle = 'rgba(0,0,0,0.1)';
                this.ctx.lineWidth = 1;
                this.ctx.beginPath();
                this.ctx.moveTo(120, y + matchHeight);
                this.ctx.lineTo(w - 120, y + matchHeight);
                this.ctx.stroke();
            }
        }
    }

    renderMatchTemplate() {
        const d = this.data.match, w = this.canvas.width, h = this.canvas.height;
        const gradient = this.ctx.createLinearGradient(0, 0, w, h);
        gradient.addColorStop(0, d.color1); gradient.addColorStop(1, d.color2);
        this.ctx.fillStyle = gradient; this.ctx.fillRect(0, 0, w, h);
        this.drawPattern(w, h);
        if (d.bgImage) { const img = new Image(); img.src = d.bgImage; img.onload = () => { this.ctx.drawImage(img, 0, 0, w, h); this.ctx.fillStyle = 'rgba(0,0,0,0.5)'; this.ctx.fillRect(0, 0, w, h); this.drawPattern(w, h); this.renderMatchContent(d, w, h); }; } 
        else this.renderMatchContent(d, w, h);
    }

    renderMatchContent(d, w, h) {
        const font = this.currentFont;
        this.ctx.fillStyle = 'rgba(255,255,255,0.95)'; this.roundRect(w/2 - 200, 100, 400, 80, 40); this.ctx.fill();
        this.ctx.fillStyle = d.color1; this.ctx.font = `bold 36px ${font}, sans-serif`; this.ctx.textAlign = 'center';
        this.applyTextEffect('MATCH √Ä VENIR', w/2, 155, 36, font);
        this.ctx.font = `bold ${d.textSize}px ${font}, sans-serif`; this.ctx.fillStyle = 'white';
        this.applyTextEffect(d.homeTeam, w/2, h/2 - 100, d.textSize, font);
        this.ctx.font = `bold 60px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.8)';
        this.applyTextEffect('VS', w/2, h/2, 60, font);
        this.ctx.font = `bold ${d.textSize}px ${font}, sans-serif`; this.ctx.fillStyle = 'white';
        this.applyTextEffect(d.awayTeam, w/2, h/2 + 100, d.textSize, font);
        this.ctx.fillStyle = 'rgba(255,255,255,0.95)'; this.roundRect(120, h - 300, w - 240, 200, 30); this.ctx.fill();
        this.ctx.fillStyle = '#1f2937'; this.ctx.font = `bold 40px ${font}, sans-serif`;
        this.applyTextEffect(d.date, w/2, h - 220, 40, font);
        this.ctx.font = `bold 50px ${font}, sans-serif`;
        this.applyTextEffect(d.time, w/2, h - 160, 50, font);
        this.ctx.font = `600 32px ${font}, sans-serif`; this.ctx.fillStyle = d.color1;
        this.applyTextEffect(d.stadium, w/2, h - 110, 32, font);
    }

    renderScoreTemplate() {
        const d = this.data.score, w = this.canvas.width, h = this.canvas.height, font = this.currentFont;
        this.ctx.fillStyle = '#0f172a'; this.ctx.fillRect(0, 0, w, h);
        this.drawPattern(w, h);
        const gradient = this.ctx.createLinearGradient(0, 0, w, h); gradient.addColorStop(0, d.color1); gradient.addColorStop(1, d.color2);
        this.ctx.fillStyle = gradient; this.roundRect(w/2 - 200, 100, 400, 80, 40); this.ctx.fill();
        this.ctx.fillStyle = 'white'; this.ctx.font = `bold 36px ${font}, sans-serif`; this.ctx.textAlign = 'center';
        this.applyTextEffect('SCORE FINAL', w/2, 155, 36, font);
        this.ctx.font = `600 28px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.6)';
        this.applyTextEffect(d.competition, w/2, 220, 28, font);
        this.ctx.fillStyle = 'rgba(255,255,255,0.05)'; this.roundRect(100, h/2 - 250, w - 200, 500, 40); this.ctx.fill();
        if (d.homeLogo) { const img = new Image(); img.src = d.homeLogo; img.onload = () => this.ctx.drawImage(img, w/2 - 290, h/2 - 200, 100, 100); }
        if (d.awayLogo) { const img = new Image(); img.src = d.awayLogo; img.onload = () => this.ctx.drawImage(img, w/2 + 190, h/2 - 200, 100, 100); }
        this.ctx.fillStyle = 'white'; this.ctx.font = `bold ${d.textSize}px ${font}, sans-serif`;
        this.applyTextEffect(d.homeTeam, w/2 - 200, h/2 - 100, d.textSize, font);
        this.ctx.font = `bold 140px ${font}, sans-serif`; this.ctx.fillStyle = d.color1;
        this.applyTextEffect(d.homeScore.toString(), w/2 - 200, h/2 + 50, 140, font);
        this.ctx.fillStyle = 'rgba(255,255,255,0.3)'; this.ctx.font = `bold 60px ${font}, sans-serif`;
        this.applyTextEffect('-', w/2, h/2 + 50, 60, font);
        this.ctx.fillStyle = 'white'; this.ctx.font = `bold ${d.textSize}px ${font}, sans-serif`;
        this.applyTextEffect(d.awayTeam, w/2 + 200, h/2 - 100, d.textSize, font);
        this.ctx.font = `bold 140px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.5)';
        this.applyTextEffect(d.awayScore.toString(), w/2 + 200, h/2 + 50, 140, font);
        this.ctx.font = `600 32px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.5)';
        this.applyTextEffect(d.date, w/2, h - 100, 32, font);
    }

    renderPlayerTemplate() {
        const d = this.data.player, w = this.canvas.width, h = this.canvas.height, font = this.currentFont;
        const gradient = this.ctx.createLinearGradient(0, 0, w, h); gradient.addColorStop(0, d.color1); gradient.addColorStop(1, d.color2);
        this.ctx.fillStyle = gradient; this.ctx.fillRect(0, 0, w, h);
        this.drawPattern(w, h);
        if (d.playerPhoto) { const img = new Image(); img.src = d.playerPhoto; img.onload = () => { this.ctx.save(); this.ctx.globalAlpha = 0.3; this.ctx.drawImage(img, w - 600, 0, 600, h); this.ctx.restore(); }; }
        this.ctx.fillStyle = 'rgba(255,255,255,0.95)'; this.roundRect(w/2 - 250, 80, 500, 100, 50); this.ctx.fill();
        this.ctx.fillStyle = d.color1; this.ctx.font = `bold 42px ${font}, sans-serif`; this.ctx.textAlign = 'center';
        this.applyTextEffect('JOUEUR DU MATCH', w/2, 145, 42, font);
        this.ctx.fillStyle = 'white'; this.ctx.font = `bold ${d.textSize}px ${font}, sans-serif`;
        this.applyTextEffect(d.playerName, w/2, h/2 - 50, d.textSize, font);
        this.ctx.fillStyle = 'rgba(255,255,255,0.95)'; this.roundRect(w/2 - 100, h/2 - 20, 200, 200, 100); this.ctx.fill();
        this.ctx.fillStyle = d.color1; this.ctx.font = `bold 120px ${font}, sans-serif`;
        this.applyTextEffect(d.number, w/2, h/2 + 110, 120, font);
        this.ctx.fillStyle = 'white'; this.ctx.font = `600 40px ${font}, sans-serif`;
        this.applyTextEffect(d.position, w/2, h/2 + 220, 40, font);
        this.ctx.font = `600 32px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.9)';
        this.applyTextEffect(d.stats, w/2, h - 150, 32, font);
        this.ctx.font = `bold 36px ${font}, sans-serif`;
        this.applyTextEffect(d.team, w/2, h - 80, 36, font);
    }

    renderRankingTemplate() {
        const d = this.data.ranking, w = this.canvas.width, h = this.canvas.height, font = this.currentFont;
        const gradient = this.ctx.createLinearGradient(0, 0, w, h); gradient.addColorStop(0, d.color1); gradient.addColorStop(1, d.color2);
        this.ctx.fillStyle = gradient; this.ctx.fillRect(0, 0, w, h);
        this.drawPattern(w, h);
        this.ctx.fillStyle = 'white'; this.ctx.font = `bold 80px ${font}, sans-serif`; this.ctx.textAlign = 'center';
        this.applyTextEffect(d.title, w/2, 150, 80, font);
        this.ctx.font = `600 32px ${font}, sans-serif`; this.ctx.fillStyle = 'rgba(255,255,255,0.8)';
        this.applyTextEffect(d.competition, w/2, 210, 32, font);
        this.ctx.fillStyle = 'rgba(255,255,255,0.95)'; this.roundRect(80, 280, w - 160, h - 380, 30); this.ctx.fill();
        const teams = d.teams.split('\n').filter(t => t.trim());
        this.ctx.fillStyle = '#1f2937'; this.ctx.font = `600 ${d.textSize}px ${font}, sans-serif`; this.ctx.textAlign = 'left';
        teams.forEach((team, i) => { const y = 360 + i * (d.textSize + 20); this.applyTextEffect(team, 140, y, d.textSize, font); });
    }

    roundRect(x, y, width, height, radius) {
        this.ctx.beginPath(); this.ctx.moveTo(x + radius, y); this.ctx.lineTo(x + width - radius, y);
        this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius); this.ctx.lineTo(x + width, y + height - radius);
        this.ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height); this.ctx.lineTo(x + radius, y + height);
        this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius); this.ctx.lineTo(x, y + radius);
        this.ctx.quadraticCurveTo(x, y, x + radius, y); this.ctx.closePath();
    }

    download() {
        const link = document.createElement('a');
        link.download = `sportvisual-${this.currentTemplate}-${this.currentFormat}-${Date.now()}.png`;
        link.href = this.canvas.toDataURL('image/png');
        link.click();
    }
}

new SportVisual();
</script>
</body>
</html>